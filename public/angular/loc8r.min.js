(function(){angular.module("apilaApp",["ngRoute","ngSanitize","ui.bootstrap"]);function e(e,t){e.when("/",{templateUrl:"/common/views/home.view.html",controller:"homeCtrl",controllerAs:"vm"}).when("/about",{templateUrl:"/common/views/genericText.view.html",controller:"aboutCtrl",controllerAs:"vm"}).when("/locations",{templateUrl:"/locations/locationsHome/locationsHome.view.html",controller:"locationHomeCtrl",controllerAs:"vm"}).when("/locations/:locationid",{templateUrl:"/locations/locationDetail/locationDetail.view.html",controller:"locationDetailCtrl",controllerAs:"vm"}).when("/register",{templateUrl:"/auth/register/register.view.html",controller:"registerCtrl",controllerAs:"vm"}).when("/login",{templateUrl:"/auth/login/login.view.html",controller:"loginCtrl",controllerAs:"vm"}).when("/issues",{templateUrl:"/issues/issueHome/issueHome.view.html",controller:"issueHomeCtrl",controllerAs:"vm"}).when("/issues/:issueid",{templateUrl:"/issues/issueDetail/issueDetail.view.html",controller:"issueDetailCtrl",controllerAs:"vm"}).when("/appointments",{templateUrl:"/appointments/appointmentHome/appointmentHome.view.html",controller:"appointmentHomeCtrl",controllerAs:"vm"}).when("/appointments/:appointmentid",{templateUrl:"/appointments/appointmentDetail/appointmentDetail.view.html",controller:"appointmentDetailCtrl",controllerAs:"vm"}).otherwise({redirectTo:"/"});t.html5Mode(true)}angular.module("apilaApp").config(["$routeProvider","$locationProvider",e])})();(function(){angular.module("apilaApp").controller("locationHomeCtrl",e);e.$inject=["$scope","apilaData","geolocation","$uibModal"];function e(e,t,n,a){var o=this;console.log(window.location);o.pageHeader={title:"Apila",strapline:"Find places to work with wifi near you!"};o.sidebar={content:"Looking for wifi and a seat? Loc8r helps you find places to work when out and about. Perhaps with coffee, cake or a pint? Let Loc8r help you find the place you're looking for."};o.message="Checking your location";o.getData=function(e){var n=e.coords.latitude,a=e.coords.longitude;o.message="Searching for nearby places";t.locationByCoords(n,a).success(function(e){o.message=e.length>0?"":"No locations found nearby";o.data={locations:e};console.log(o.data)}).error(function(e){o.message="Sorry, something's gone wrong, please try again later"})};o.showError=function(t){e.$apply(function(){o.message=t.message})};o.noGeo=function(){e.$apply(function(){o.message="Geolocation is not supported by this browser."})};n.getPosition(o.getData,o.showError,o.noGeo);o.popupNewLocationForm=function(){var e=a.open({templateUrl:"/locations/addLocationModal/addLocationModal.view.html",controller:"newLocationModalCtrl as vm"})}}})();(function(){angular.module("apilaApp").controller("issueHomeCtrl",e);e.$inject=["$scope","apilaData","authentication","$uibModal"];function e(e,t,n,a){var o=this;o.isLoggedIn=n.isLoggedIn();o.pageHeader={title:"Apila",strapline:"its a website!"};o.message="Checking your location";o.message="Searching for nearby places";t.issuesList().success(function(e){o.message=e.length>0?"":"No issues found";o.data={issues:e};console.log(o.data)}).error(function(e){o.message="Sorry, something's gone wrong, please try again later"});o.showError=function(t){e.$apply(function(){o.message=t.message})};o.popupNewIssueForm=function(){var e=a.open({templateUrl:"/issues/newIssueModal/newIssueModal.view.html",controller:"newIssueModalCtrl as vm"})}}})();(function(){angular.module("apilaApp").controller("issueDetailCtrl",e);e.$inject=["$routeParams","$location","apilaData","authentication","$uibModal"];function e(e,t,n,a,o){var i=this;i.issueid=e.issueid;i.isLoggedIn=a.isLoggedIn();i.currentPath=t.path();n.issueById(i.issueid).success(function(e){i.data={issue:e};i.pageHeader={title:i.data.issue.title}}).error(function(e){console.log(e)});i.popupIssueCommentForm=function(){var e=o.open({templateUrl:"/issues/issueCommentModal/issueCommentModal.view.html",controller:"issueCommentModalCtrl as vm",resolve:{issueData:function(){return{issueid:i.issueid,issueTitle:i.data.issue.title}}}});e.result.then(function(e){i.data.issue.comments.push(e)})}}})();(function(){angular.module("apilaApp").controller("newIssueModalCtrl",e);e.$inject=["$uibModalInstance"];function e(e){var t=this;t.modal={close:function(t){e.close(t)},cancel:function(){e.dismiss("cancel")}}}})();(function(){angular.module("apilaApp").controller("issueCommentModalCtrl",e);e.$inject=["$uibModalInstance","issueData","apilaData"];function e(e,t,n){var a=this;a.issueData=t;a.onSubmit=function(){a.formError="";if(!a.formData.commentText){a.formError="All fields required, please try again";return false}else{a.doAddIssueComment(a.issueData.issueid,a.formData)}};a.doAddIssueComment=function(e,t){n.addIssueCommentById(e,{commentText:t.commentText}).success(function(e){a.modal.close(e)}).error(function(e){a.formError="Your comment has not been saved, please try again"});return false};a.modal={close:function(t){e.close(t)},cancel:function(){e.dismiss("cancel")}}}})();(function(){angular.module("apilaApp").controller("appointmentHomeCtrl",e);e.$inject=["$scope","apilaData","$uibModal","authentication"];function e(e,t,n,a){var o=this;o.isLoggedIn=a.isLoggedIn();o.pageHeader={title:"Apila",strapline:"its a website!"};o.message="Checking your location";o.message="Searching for nearby places";t.appointmentsList().success(function(e){o.message=e.length>0?"":"No appointments were found";t.appointList={appointments:e};o.data=t.appointList}).error(function(e){o.message="Sorry, something's gone wrong, please try again later"});o.showError=function(t){e.$apply(function(){o.message=t.message})};o.popupNewAppointmentForm=function(){var e=n.open({templateUrl:"/appointments/addAppointmentModal/addAppointmentModal.view.html",controller:"newAppointmentModalCtrl as vm"})};o.popupUpdateAppointmentForm=function(e){var t=n.open({templateUrl:"/appointments/updateAppointmentModal/updateAppointmentModal.view.html",controller:"updateAppointmentModalCtrl as vm",resolve:{getAppointment:function(){return e}}})}}})();(function(){angular.module("apilaApp").controller("appointmentDetailCtrl",e);e.$inject=["$routeParams","$location","apilaData","authentication","$uibModal"];function e(e,t,n,a,o){var i=this;i.appointmentid=e.appointmentid;i.isLoggedIn=a.isLoggedIn();i.currentPath=t.path();i.currentDate=new Date;n.appointmentById(i.appointmentid).success(function(e){i.data={appointment:e};i.pageHeader={title:i.data.appointment.residentGoing+" going to "+i.data.appointment.locationName}}).error(function(e){console.log(e)})}})();(function(){angular.module("apilaApp").controller("newAppointmentModalCtrl",e);e.$inject=["$scope","$uibModalInstance","apilaData","authentication"];function e(e,t,n,a){var o=this;o.isLoggedIn=a.isLoggedIn();o.onSubmit=function(){o.formError="";if(!o.formData.reason||!o.formData.residentGoing||!o.formData.locationName||!o.formData.time||!o.formData.date){o.formError="All fields required, please try again";return false}else{o.doAddAppointment(o.formData)}};o.doAddAppointment=function(e){n.addAppointment(e).success(function(e){n.appointList.appointments.push(e);o.modal.close(e)}).error(function(e){o.formError="Something went wrong with the appointment, try again"});return false};o.popup={opened:false};o.open=function(){o.popup.opened=true};o.dateOptions={formatYear:"yy",maxDate:new Date(2020,5,22),minDate:new Date,startingDay:1};o.open=function(){o.popup.opened=true};o.modal={close:function(e){t.close(e)},cancel:function(){t.dismiss("cancel")}}}})();(function(){angular.module("apilaApp").controller("updateAppointmentModalCtrl",e);e.$inject=["$scope","$uibModalInstance","apilaData","authentication","getAppointment"];function e(e,t,n,a,o){var i=this;i.isLoggedIn=a.isLoggedIn();i.formData=o;i.formData.date=new Date(o.time);i.formData.modifiedBy=a.currentUser().name;i.formData.updateInfo.updateBy=a.currentUser().name;i.onSubmit=function(){i.formData.modifiedDate=new Date;i.formData.updateInfo.updateDate=new Date;i.formError="";if(!i.formData.reason||!i.formData.residentGoing||!i.formData.locationName||!i.formData.time||!i.formData.date){i.formError="All fields required, please try again";return false}else{i.updateAppointment(i.formData._id,i.formData)}};i.updateAppointment=function(e,t){n.updateAppointment(e,t).success(function(e){i.modal.close(e)}).error(function(e){i.formError="Something went wrong with updating the appointment, try again"});return false};i.popup={opened:false};i.open=function(){i.popup.opened=true};i.dateOptions={formatYear:"yy",maxDate:new Date(2020,5,22),minDate:new Date,startingDay:1};i.open=function(){i.popup.opened=true};i.modal={close:function(e){t.close(e)},cancel:function(){t.dismiss("cancel")}}}})();(function(){angular.module("apilaApp").controller("aboutCtrl",e);function e(){var e=this;e.pageHeader={title:"About Apila"};e.main={content:"Apila\n\nLorem ipsum dolor sit amet, consectetur adipiscing elit. Nunc sed lorem ac nisi dignissim accumsan. Nullam sit amet interdum magna. Morbi quis faucibus nisi. Vestibulum mollis purus quis eros adipiscing tristique. Proin posuere semper tellus, id placerat augue dapibus ornare. Aenean leo metus, tempus in nisl eget, accumsan interdum dui. Pellentesque sollicitudin volutpat ullamcorper.\n\nSuspendisse tincidunt, lectus non suscipit pharetra, purus ipsum vehicula sapien, a volutpat mauris ligula vel dui. Proin varius interdum elit, eu porttitor quam consequat et. Quisque vitae felis sed ante fringilla fermentum in vitae sem. Quisque fermentum metus at neque sagittis imperdiet. Phasellus non laoreet massa, eu laoreet nibh. Pellentesque vel magna vulputate, porta augue vel, dapibus nisl. Phasellus aliquet nibh nec nunc posuere fringilla. Quisque sit amet dignissim erat. Nulla facilisi. Donec in sollicitudin ante. Cras rhoncus accumsan rutrum. Sed aliquet ligula dui, eget laoreet turpis tempor vitae."}}})();(function(){angular.module("apilaApp").controller("homeCtrl",e);function e(){var e=this;e.pageHeader={title:"Apila Home"};e.main={content:"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nunc sed lorem ac nisi dignissim accumsan. Nullam sit amet interdum magna. Morbi quis faucibus nisi. Vestibulum mollis purus quis eros adipiscing tristique. Proin posuere semper tellus, id placerat augue dapibus ornare. Aenean leo metus, tempus in nisl eget, accumsan interdum dui. Pellentesque sollicitudin volutpat ullamcorper.\n\nSuspendisse tincidunt, lectus non suscipit pharetra, purus ipsum vehicula sapien, a volutpat mauris ligula vel dui. Proin varius interdum elit, eu porttitor quam consequat et. Quisque vitae felis sed ante fringilla fermentum in vitae sem. Quisque fermentum metus at neque sagittis imperdiet. Phasellus non laoreet massa, eu laoreet nibh. Pellentesque vel magna vulputate, porta augue vel, dapibus nisl. Phasellus aliquet nibh nec nunc posuere fringilla. Quisque sit amet dignissim erat. Nulla facilisi. Donec in sollicitudin ante. Cras rhoncus accumsan rutrum. Sed aliquet ligula dui, eget laoreet turpis tempor vitae."}}})();(function(){angular.module("apilaApp").controller("loginCtrl",e);e.$inject=["$location","authentication"];function e(e,t){var n=this;n.pageHeader={title:"Sign in to Loc8r"};n.credentials={email:"",password:""};n.returnPage=e.search().page||"/";n.onSubmit=function(){n.formError="";if(!n.credentials.email||!n.credentials.password){n.formError="All fields required, please try again";return false}else{n.doLogin()}};n.doLogin=function(){n.formError="";t.login(n.credentials).error(function(e){n.formError=e}).then(function(){e.search("page",null);e.path(n.returnPage)})}}})();(function(){angular.module("apilaApp").controller("registerCtrl",e);e.$inject=["$location","authentication"];function e(e,t){var n=this;n.pageHeader={title:"Create a new Loc8r account"};n.credentials={name:"",email:"",password:""};n.returnPage=e.search().page||"/";n.onSubmit=function(){n.formError="";if(!n.credentials.name||!n.credentials.email||!n.credentials.password){n.formError="All fields required, please try again";return false}else{n.doRegister()}};n.doRegister=function(){n.formError="";t.register(n.credentials).error(function(e){n.formError=e}).then(function(){e.search("page",null);e.path(n.returnPage)})}}})();(function(){angular.module("apilaApp").controller("locationDetailCtrl",e);e.$inject=["$routeParams","$location","$uibModal","apilaData","authentication"];function e(e,t,n,a,o){var i=this;i.locationid=e.locationid;i.isLoggedIn=o.isLoggedIn();i.currentPath=t.path();a.locationById(i.locationid).success(function(e){i.data={location:e};i.pageHeader={title:i.data.location.name}}).error(function(e){console.log(e)});i.popupReviewForm=function(){var e=n.open({templateUrl:"/locations/reviewModal/reviewModal.view.html",controller:"reviewModalCtrl as vm",resolve:{locationData:function(){return{locationid:i.locationid,locationName:i.data.location.name}}}});e.result.then(function(e){i.data.location.reviews.push(e)})}}})();(function(){angular.module("apilaApp").controller("reviewModalCtrl",e);e.$inject=["$uibModalInstance","apilaData","locationData"];function e(e,t,n){var a=this;a.locationData=n;a.onSubmit=function(){a.formError="";if(!a.formData.rating||!a.formData.reviewText){a.formError="All fields required, please try again";return false}else{a.doAddReview(a.locationData.locationid,a.formData)}};a.doAddReview=function(e,n){t.addReviewById(e,{rating:n.rating,reviewText:n.reviewText}).success(function(e){a.modal.close(e)}).error(function(e){a.formError="Your review has not been saved, please try again"});return false};a.modal={close:function(t){e.close(t)},cancel:function(){e.dismiss("cancel")}}}})();(function(){angular.module("apilaApp").service("authentication",e);e.$inject=["$http","$window"];function e(e,t){var n=function(e){t.localStorage["apila-token"]=e};var a=function(){return t.localStorage["apila-token"]};var o=function(){var e=a();if(e){var n=JSON.parse(t.atob(e.split(".")[1]));return n.exp>Date.now()/1e3}else{return false}};var i=function(){if(o()){var e=a();var n=JSON.parse(t.atob(e.split(".")[1]));return{email:n.email,name:n.name}}};register=function(t){return e.post("/api/register",t).success(function(e){n(e.token)})};login=function(t){return e.post("/api/login",t).success(function(e){n(e.token)})};logout=function(){t.localStorage.removeItem("apila-token")};return{currentUser:i,saveToken:n,getToken:a,isLoggedIn:o,register:register,login:login,logout:logout}}})();(function(){angular.module("apilaApp").service("geolocation",e);function e(){var e=function(e,t,n){if(navigator.geolocation){navigator.geolocation.getCurrentPosition(e,t)}else{n()}};return{getPosition:e}}})();(function(){angular.module("apilaApp").service("apilaData",e);e.$inject=["$http","authentication"];function e(e,t){var n=function(t,n){return e.get("/api/locations?lng="+n+"&lat="+t+"&maxDistance=20")};var a=null;var o=function(t){return e.get("/api/locations/"+t)};var i=function(n,a){return e.post("/api/locations/"+n+"/reviews",a,{headers:{Authorization:"Bearer "+t.getToken()}})};var r=function(n){return e.post("/api/locations/",n,{headers:{Authorization:"Bearer "+t.getToken()}})};var l=function(){return e.get("/api/issues")};var s=function(t){return e.get("/api/issues/"+t)};var u=function(n,a){return e.post("/api/issues/"+n+"/comments",a,{headers:{Authorization:"Bearer "+t.getToken()}})};var c=function(){return e.get("/api/appointments")};var p=function(t){return e.get("/api/appointments/"+t)};var m=function(n){return e.post("/api/appointments/new",n,{headers:{Authorization:"Bearer "+t.getToken()}})};var d=function(t,n){return e.put("/api/appointments/update/"+t,n)};return{locationByCoords:n,locationById:o,addReviewById:i,issuesList:l,issueById:s,addIssueCommentById:u,appointmentsList:c,appointmentById:p,addAppointment:m,updateAppointment:d}}})();(function(){angular.module("apilaApp").filter("formatDistance",t);var e=function(e){return!isNaN(parseFloat(e))&&isFinite(e)};function t(){return function(t){var n,a;if(t&&e(t)){if(t>1){n=parseFloat(t).toFixed(1);a="km"}else{n=parseInt(t*1e3,10);a="m"}return n+a}else{return"?"}}}})();(function(){angular.module("apilaApp").filter("addHtmlLineBreaks",e);function e(){return function(e){var t=e.replace(/\n/g,"<br/>");return t}}})();(function(){angular.module("apilaApp").controller("navigationCtrl",e);e.$inject=["$location","authentication"];function e(e,t){var n=this;n.currentPath=e.path();n.isLoggedIn=t.isLoggedIn();n.currentUser=t.currentUser();n.logout=function(){t.logout();e.path("/")}}})();(function(){angular.module("apilaApp").directive("navigation",e);function e(){return{restrict:"EA",templateUrl:"/common/directives/navigation/navigation.template.html",controller:"navigationCtrl as navvm"}}})();(function(){angular.module("apilaApp").directive("footerGeneric",e);function e(){return{restrict:"EA",templateUrl:"/common/directives/footerGeneric/footerGeneric.template.html"}}})();(function(){angular.module("apilaApp").directive("pageHeader",e);function e(){return{restrict:"EA",scope:{content:"=content"},templateUrl:"/common/directives/pageHeader/pageHeader.template.html"}}})();(function(){angular.module("apilaApp").directive("ratingStars",e);function e(){return{restrict:"EA",scope:{thisRating:"=rating"},templateUrl:"/common/directives/ratingStars/ratingStars.template.html"}}})();